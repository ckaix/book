<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN" "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <!--<script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>-->
    <title>ç‰¹åˆ«æ”¾é€-ç»™ä½ ä¸€ä»½Goé¡¹ç›®ä¸­æœ€å¸¸ç”¨çš„Makefileæ ¸å¿ƒè¯­æ³•</title>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
        <style>
        html {
            color: #333;
            -webkit-text-size-adjust: 100%;
            -ms-text-size-adjust: 100%;
            text-rendering: optimizelegibility;
            font-family: Helvetica Neue, PingFang SC, Verdana, Microsoft Yahei, Hiragino Sans GB, Microsoft Sans Serif, WenQuanYi Micro Hei, sans-serif
        }

        html.borderbox *,
        html.borderbox :after,
        html.borderbox :before {
            box-sizing: border-box
        }

        article,
        aside,
        blockquote,
        body,
        button,
        code,
        dd,
        details,
        dl,
        dt,
        fieldset,
        figcaption,
        figure,
        footer,
        form,
        h1,
        h2,
        h3,
        h4,
        h5,
        h6,
        header,
        hr,
        input,
        legend,
        li,
        menu,
        nav,
        ol,
        p,
        pre,
        section,
        td,
        textarea,
        th,
        ul {
            margin: 0;
            padding: 0
        }

        article,
        aside,
        details,
        figcaption,
        figure,
        footer,
        header,
        menu,
        nav,
        section {
            display: block
        }

        audio,
        canvas,
        video {
            display: inline-block
        }

        body,
        button,
        input,
        select,
        textarea {
            font: 300 1em/1.8 PingFang SC, Lantinghei SC, Microsoft Yahei, Hiragino Sans GB, Microsoft Sans Serif, WenQuanYi Micro Hei, Helvetica, sans-serif
        }

        button::-moz-focus-inner,
        input::-moz-focus-inner {
            padding: 0;
            border: 0
        }

        table {
            border-collapse: collapse;
            border-spacing: 0
        }

        fieldset,
        img {
            border: 0
        }

        blockquote {
            position: relative;
            color: #999;
            font-weight: 400;
            border-left: 1px solid #1abc9c;
            padding-left: 1em;
            margin: 1em 3em 1em 2em
        }

        @media only screen and (max-width: 640px) {
            blockquote {
                margin: 1em 0
            }
        }

        abbr,
        acronym {
            border-bottom: 1px dotted;
            font-variant: normal
        }

        abbr {
            cursor: help
        }

        del {
            text-decoration: line-through
        }

        address,
        caption,
        cite,
        code,
        dfn,
        em,
        th,
        var {
            font-style: normal;
            font-weight: 400
        }

        ol,
        ul {
            list-style: none
        }

        caption,
        th {
            text-align: left
        }

        q:after,
        q:before {
            content: ""
        }

        sub,
        sup {
            font-size: 75%;
            line-height: 0;
            position: relative
        }

        :root sub,
        :root sup {
            vertical-align: baseline
        }

        sup {
            top: -.5em
        }

        sub {
            bottom: -.25em
        }

        a {
            color: #1abc9c
        }

        a:hover {
            text-decoration: underline
        }

        .typo a {
            border-bottom: 1px solid #1abc9c
        }

        .typo a:hover {
            border-bottom-color: #555;
            color: #555
        }

        .typo a:hover,
        a,
        ins {
            text-decoration: none
        }

        .typo-u,
        u {
            text-decoration: underline
        }

        mark {
            background: #fffdd1;
            border-bottom: 1px solid #ffedce;
            padding: 2px;
            margin: 0 5px
        }

        code,
        pre,
        pre tt {
            font-family: Courier, Courier New, monospace
        }

        pre {
            background: hsla(0, 0%, 97%, .7);
            border: 1px solid #ddd;
            padding: 1em 1.5em;
            display: block;
            -webkit-overflow-scrolling: touch
        }

        hr {
            border: none;
            border-bottom: 1px solid #cfcfcf;
            margin-bottom: .8em;
            height: 10px
        }

        .typo-small,
        figcaption,
        small {
            font-size: .9em;
            color: #888
        }

        b,
        strong {
            font-weight: 700;
            color: #000
        }

        [draggable] {
            cursor: move
        }

        .clearfix:after,
        .clearfix:before {
            content: "";
            display: table
        }

        .clearfix:after {
            clear: both
        }

        .clearfix {
            zoom: 1
        }

        .textwrap,
        .textwrap td,
        .textwrap th {
            word-wrap: break-word;
            word-break: break-all
        }

        .textwrap-table {
            table-layout: fixed
        }

        .serif {
            font-family: Palatino, Optima, Georgia, serif
        }

        .typo-dl,
        .typo-form,
        .typo-hr,
        .typo-ol,
        .typo-p,
        .typo-pre,
        .typo-table,
        .typo-ul,
        .typo dl,
        .typo form,
        .typo hr,
        .typo ol,
        .typo p,
        .typo pre,
        .typo table,
        .typo ul,
        blockquote {
            margin-bottom: 1rem
        }

        h1,
        h2,
        h3,
        h4,
        h5,
        h6 {
            font-family: PingFang SC, Helvetica Neue, Verdana, Microsoft Yahei, Hiragino Sans GB, Microsoft Sans Serif, WenQuanYi Micro Hei, sans-serif;
            color: #000;
            line-height: 1.35
        }

        .typo-h1,
        .typo-h2,
        .typo-h3,
        .typo-h4,
        .typo-h5,
        .typo-h6,
        .typo h1,
        .typo h2,
        .typo h3,
        .typo h4,
        .typo h5,
        .typo h6 {
            margin-top: 1.2em;
            margin-bottom: .6em;
            line-height: 1.35
        }

        .typo-h1,
        .typo h1 {
            font-size: 2em
        }

        .typo-h2,
        .typo h2 {
            font-size: 1.8em
        }

        .typo-h3,
        .typo h3 {
            font-size: 1.6em
        }

        .typo-h4,
        .typo h4 {
            font-size: 1.4em
        }

        .typo-h5,
        .typo-h6,
        .typo h5,
        .typo h6 {
            font-size: 1.2em
        }

        .typo-ul,
        .typo ul {
            margin-left: 1.3em;
            list-style: disc
        }

        .typo-ol,
        .typo ol {
            list-style: decimal;
            margin-left: 1.9em
        }

        .typo-ol ol,
        .typo-ol ul,
        .typo-ul ol,
        .typo-ul ul,
        .typo li ol,
        .typo li ul {
            margin-bottom: .8em;
            margin-left: 2em
        }

        .typo-ol ul,
        .typo-ul ul,
        .typo li ul {
            list-style: circle
        }

        .typo-table td,
        .typo-table th,
        .typo table caption,
        .typo table td,
        .typo table th {
            border: 1px solid #ddd;
            padding: .5em 1em;
            color: #666
        }

        .typo-table th,
        .typo table th {
            background: #fbfbfb
        }

        .typo-table thead th,
        .typo table thead th {
            background: hsla(0, 0%, 95%, .7)
        }

        .typo table caption {
            border-bottom: none
        }

        .typo-input,
        .typo-textarea {
            -webkit-appearance: none;
            border-radius: 0
        }

        .typo-em,
        .typo em,
        caption,
        legend {
            color: #000;
            font-weight: inherit
        }

        .typo-em {
            position: relative
        }

        .typo-em:after {
            position: absolute;
            top: .65em;
            left: 0;
            width: 100%;
            overflow: hidden;
            white-space: nowrap;
            content: "\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB"
        }

        .typo img {
            max-width: 100%
        }

        .common-content {
            font-weight: 400;
            color: #353535;
            line-height: 1.75rem;
            white-space: normal;
            word-break: normal;
            font-size: 1rem
        }

        .common-content img {
            display: block;
            max-width: 100%;
            background-color: #eee
        }

        .common-content audio,
        .common-content video {
            width: 100%;
            background-color: #eee
        }

        .common-content center,
        .common-content font {
            margin-top: 1rem;
            display: inline-block
        }

        .common-content center {
            width: 100%
        }

        .common-content pre {
            margin-top: 1rem;
            padding-left: 0;
            padding-right: 0;
            position: relative;
            overflow: hidden
        }

        .common-content pre code {
            font-size: .8rem;
            font-family: Consolas, Liberation Mono, Menlo, monospace, Courier;
            display: block;
            width: 100%;
            box-sizing: border-box;
            padding-left: 1rem;
            padding-right: 1rem;
            overflow-x: auto
        }

        .common-content hr {
            border: none;
            margin-top: 1.5rem;
            margin-bottom: 1.5rem;
            border-top: 1px solid #f5f5f5;
            height: 1px;
            background: none
        }

        .common-content b,
        .common-content h1,
        .common-content h2,
        .common-content h3,
        .common-content h4,
        .common-content h5,
        .common-content strong {
            font-weight: 700
        }

        .common-content h1,
        .common-content h2 {
            font-size: 1.125rem;
            margin-bottom: .45rem
        }

        .common-content h3,
        .common-content h4,
        .common-content h5 {
            font-size: 1rem;
            margin-bottom: .45rem
        }

        .common-content p {
            font-weight: 400;
            color: #353535;
            margin-top: .15rem
        }

        .common-content .orange {
            color: #ff5a05
        }

        .common-content .reference {
            font-size: 1rem;
            color: #888
        }

        .custom-rich-content h1 {
            margin-top: 0;
            font-weight: 400;
            font-size: 15.25px;
            border-bottom: 1px solid #eee;
            line-height: 2.8
        }

        .custom-rich-content li,
        .custom-rich-content p {
            font-size: 14px;
            color: #888;
            line-height: 1.6
        }

        table.hljs-ln {
            margin-bottom: 0;
            border-spacing: 0;
            border-collapse: collapse
        }

        table.hljs-ln,
        table.hljs-ln tbody,
        table.hljs-ln td,
        table.hljs-ln tr {
            box-sizing: border-box
        }

        table.hljs-ln td {
            padding: 0;
            border: 0
        }

        table.hljs-ln td.hljs-ln-numbers {
            min-width: 15px;
            color: rgba(27, 31, 35, .3);
            text-align: right;
            white-space: nowrap;
            cursor: pointer;
            user-select: none
        }

        table.hljs-ln td.hljs-ln-code,
        table.hljs-ln td.hljs-ln-numbers {
            font-family: SFMono-Regular, Consolas, Liberation Mono, Menlo, Courier, monospace;
            font-size: 12px;
            line-height: 20px;
            vertical-align: top
        }

        table.hljs-ln td.hljs-ln-code {
            position: relative;
            padding-right: 10px;
            padding-left: 10px;
            overflow: visible;
            color: #24292e;
            word-wrap: normal;
            white-space: pre
        }

        video::-webkit-media-controls {
            overflow: hidden !important
        }

        video::-webkit-media-controls-enclosure {
            width: calc(100% + 32px);
            margin-left: auto
        }

        ._29HP61GA_0 {
            max-width:800px;
            margin:0 auto;
            margin-bottom: 20px;
            font-weight: 400;
            color: #353535;
            line-height: 1.76;
            white-space: normal;
            word-break: normal;
            font-size: 17px;
            -webkit-transition: background-color .3s ease;
            transition: background-color .3s ease
        }

        ._29HP61GA_0 .MathJax_Display {
            overflow: auto
        }

        ._29HP61GA_0 .poster {
            position: fixed;
            left: -10000px;
            top: -10000px;
            overflow: hidden;
            padding: 1rem;
            background: #ececec
        }

        ._29HP61GA_0 .richcontent-pre-copy {
            font-size: 13px;
            color: #888;
            position: absolute;
            right: 1em;
            top: .5em;
            cursor: pointer;
            -webkit-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
            user-select: none
        }

        ._29HP61GA_0 .richcontent-pre-copy .iconfont {
            font-size: 12px;
            margin-right: .2em
        }

        ._29HP61GA_0 a {
            color: #fa8919;
            border-bottom: 1px solid #fa8919
        }

        ._29HP61GA_0 img {
            display: block;
            max-width: 100%;
            position: relative;
            left: 50%;
            -webkit-transform: translateX(-50%);
            transform: translateX(-50%);
            background-color: #eee;
            vertical-align: top;
            border-radius: 0
        }

        ._29HP61GA_0 audio,
        ._29HP61GA_0 video {
            width: 100%;
            background-color: #eee
        }

        ._29HP61GA_0 pre {
            margin-top: 16px;
            padding: 34px 0 0;
            margin-bottom: 30px;
            position: relative;
            border-radius: 6px;
            background: rgba(246, 247, 251, .749);
            border: 0
        }

        ._29HP61GA_0 pre code {
            font-size: 12px;
            font-family: Consolas, Liberation Mono, Menlo, monospace, Courier;
            display: block;
            -webkit-box-sizing: border-box;
            box-sizing: border-box;
            margin-left: 16px;
            margin-right: 16px;
            overflow-x: scroll
        }

        ._29HP61GA_0 pre code:after {
            content: "";
            height: 30px;
            width: 100%;
            display: block
        }

        ._29HP61GA_0 hr {
            border: none;
            margin-top: 1.5rem;
            margin-bottom: 1.5rem;
            border-top: 1px solid #f5f5f5;
            height: 1px;
            background: none
        }

        ._29HP61GA_0 h1,
        ._29HP61GA_0 h2,
        ._29HP61GA_0 h3,
        ._29HP61GA_0 h4,
        ._29HP61GA_0 h5 {
            margin-bottom: 20px;
            margin-top: 0;
            font-weight: 700
        }

        ._29HP61GA_0 b,
        ._29HP61GA_0 strong {
            font-weight: 700
        }

        ._29HP61GA_0 h1 {
            font-size: 21px
        }

        ._29HP61GA_0 h2 {
            font-size: 20px
        }

        ._29HP61GA_0 h3 {
            font-size: 19px
        }

        ._29HP61GA_0 h4 {
            font-size: 18px
        }

        ._29HP61GA_0 h5 {
            font-size: 17px
        }

        ._29HP61GA_0 center,
        ._29HP61GA_0 p {
            font-weight: 400;
            color: #353535;
            margin-top: 0;
            margin-bottom: 30px;
            word-break: break-word
        }

        ._29HP61GA_0 center {
            text-align: center
        }

        ._29HP61GA_0 blockquote {
            margin-top: 0;
            margin-bottom: 34px;
            border-left: 3px solid #e8e8e8;
            padding-left: 17px;
            color: #353535
        }

        ._29HP61GA_0 blockquote p {
            margin-top: 0;
            margin-bottom: 0
        }

        ._29HP61GA_0 ol,
        ._29HP61GA_0 ul {
            margin-bottom: 30px
        }

        ._29HP61GA_0 ol p,
        ._29HP61GA_0 ul p {
            margin-top: 0;
            margin-bottom: 0
        }

        ._29HP61GA_0 ol {
            list-style: decimal;
            margin-left: 20px
        }

        ._29HP61GA_0 ul li {
            padding-left: 17px;
            position: relative;
            margin-bottom: 10px
        }

        ._29HP61GA_0 ul li:after {
            content: "";
            height: 6px;
            width: 6px;
            border-radius: 50%;
            background: #353535;
            position: absolute;
            top: 10px;
            left: 0
        }

        ._29HP61GA_0 .orange {
            color: #fa8919
        }

        ._29HP61GA_0 .reference {
            color: #888
        }

        ._29HP61GA_0 .m-right {
            text-align: right
        }

        ._29HP61GA_0 .m-center {
            text-align: center;
            display: block
        }

        ._29HP61GA_0 .m-gray {
            color: #888
        }

        ._29HP61GA_0 .m-small {
            font-size: 15px
        }

        ._29HP61GA_0 table.hljs-ln {
            margin-bottom: 0;
            border-spacing: 0;
            border-collapse: collapse
        }

        ._29HP61GA_0 table.hljs-ln,
        ._29HP61GA_0 table.hljs-ln tbody,
        ._29HP61GA_0 table.hljs-ln td,
        ._29HP61GA_0 table.hljs-ln tr {
            -webkit-box-sizing: border-box;
            box-sizing: border-box
        }

        ._29HP61GA_0 table.hljs-ln td {
            padding: 0;
            border: 0
        }

        ._29HP61GA_0 table.hljs-ln td.hljs-ln-numbers {
            min-width: 15px;
            font-size: 12px;
            color: rgba(27, 31, 35, .3);
            text-align: right;
            white-space: nowrap;
            cursor: pointer;
            -webkit-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
            user-select: none
        }

        ._29HP61GA_0 table.hljs-ln td.hljs-ln-code,
        ._29HP61GA_0 table.hljs-ln td.hljs-ln-numbers {
            font-family: SFMono-Regular, Consolas, Liberation Mono, Menlo, Courier, monospace;
            line-height: 20px;
            vertical-align: top
        }

        ._29HP61GA_0 table.hljs-ln td.hljs-ln-code {
            position: relative;
            padding-right: 10px;
            padding-left: 10px;
            overflow: visible;
            font-size: 13px;
            color: #666;
            word-wrap: normal;
            white-space: pre
        }

    </style>
</head>
<body>
<div class="_29HP61GA_0">
<h1>ç‰¹åˆ«æ”¾é€-ç»™ä½ ä¸€ä»½Goé¡¹ç›®ä¸­æœ€å¸¸ç”¨çš„Makefileæ ¸å¿ƒè¯­æ³•</h1>
<p>ä½ å¥½ï¼Œæˆ‘æ˜¯å­”ä»¤é£ã€‚ä»Šå¤©ï¼Œæˆ‘ä»¬æ›´æ–°ä¸€æœŸç‰¹åˆ«æ”¾é€ä½œä¸ºâ€œåŠ é¤â€ï¼Œå¸Œæœ›æ—¥å¸¸å‚¬æ›´çš„æœ‹å‹ä»¬é£Ÿç”¨æ„‰å¿«ã€‚</p><p>åœ¨ç¬¬ <a href="https://time.geekbang.org/column/article/388920"><strong>14è®²</strong></a>  é‡Œ<strong>ï¼Œ</strong>æˆ‘å¼ºè°ƒäº†ç†Ÿç»ƒæŒæ¡Makefileè¯­æ³•çš„é‡è¦æ€§ï¼Œè¿˜æ¨èä½ å»å­¦ä¹ é™ˆçš“è€å¸ˆç¼–å†™çš„<a href="https://github.com/seisman/how-to-write-makefile">ã€Šè·Ÿæˆ‘ä¸€èµ·å†™ Makefileã€‹ (PDF é‡åˆ¶ç‰ˆ)</a>ã€‚ä¹Ÿè®¸ä½ å·²ç»ç‚¹å¼€äº†é“¾æ¥ï¼Œçœ‹åˆ°é‚£ä¹ˆå¤šMakefileè¯­æ³•ï¼Œæ˜¯ä¸æ˜¯æœ‰ç‚¹è¢«â€œåŠé€€â€çš„æ„Ÿè§‰ï¼Ÿ</p><p>å…¶å®åœ¨æˆ‘çœ‹æ¥ï¼Œè™½ç„¶Makefileæœ‰å¾ˆå¤šè¯­æ³•ï¼Œä½†ä¸æ˜¯æ‰€æœ‰çš„è¯­æ³•éƒ½éœ€è¦ä½ ç†Ÿç»ƒæŒæ¡ï¼Œæœ‰äº›è¯­æ³•åœ¨Goé¡¹ç›®ä¸­æ˜¯å¾ˆå°‘ç”¨åˆ°çš„ã€‚è¦ç¼–å†™ä¸€ä¸ªé«˜è´¨é‡çš„Makefileï¼Œé¦–å…ˆåº”è¯¥æŒæ¡ä¸€äº›æ ¸å¿ƒçš„ã€æœ€å¸¸ç”¨çš„è¯­æ³•çŸ¥è¯†ã€‚è¿™ä¸€è®²æˆ‘å°±æ¥å…·ä½“ä»‹ç»ä¸‹Goé¡¹ç›®ä¸­å¸¸ç”¨çš„Makefileè¯­æ³•å’Œè§„åˆ™ï¼Œå¸®åŠ©ä½ å¿«é€Ÿæ‰“å¥½æœ€é‡è¦çš„åŸºç¡€ã€‚</p><p>Makefileæ–‡ä»¶ç”±ä¸‰ä¸ªéƒ¨åˆ†ç»„æˆï¼Œåˆ†åˆ«æ˜¯Makefileè§„åˆ™ã€Makefileè¯­æ³•å’ŒMakefileå‘½ä»¤ï¼ˆè¿™äº›å‘½ä»¤å¯ä»¥æ˜¯Linuxå‘½ä»¤ï¼Œä¹Ÿå¯ä»¥æ˜¯å¯æ‰§è¡Œçš„è„šæœ¬æ–‡ä»¶ï¼‰ã€‚åœ¨è¿™ä¸€è®²é‡Œï¼Œæˆ‘ä¼šä»‹ç»ä¸‹Makefileè§„åˆ™å’ŒMakefileè¯­æ³•é‡Œçš„ä¸€äº›æ ¸å¿ƒè¯­æ³•çŸ¥è¯†ã€‚åœ¨ä»‹ç»è¿™äº›è¯­æ³•çŸ¥è¯†ä¹‹å‰ï¼Œæˆ‘ä»¬å…ˆæ¥çœ‹ä¸‹å¦‚ä½•ä½¿ç”¨Makefileè„šæœ¬ã€‚</p><h2>Makefileçš„ä½¿ç”¨æ–¹æ³•</h2><p>åœ¨å®é™…ä½¿ç”¨è¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬ä¸€èˆ¬æ˜¯å…ˆç¼–å†™ä¸€ä¸ªMakefileæ–‡ä»¶ï¼ŒæŒ‡å®šæ•´ä¸ªé¡¹ç›®çš„ç¼–è¯‘è§„åˆ™ï¼Œç„¶åé€šè¿‡Linux makeå‘½ä»¤æ¥è§£æè¯¥Makefileæ–‡ä»¶ï¼Œå®ç°é¡¹ç›®ç¼–è¯‘ã€ç®¡ç†çš„è‡ªåŠ¨åŒ–ã€‚</p><!-- [[[read_end]]] --><p>é»˜è®¤æƒ…å†µä¸‹ï¼Œmakeå‘½ä»¤ä¼šåœ¨å½“å‰ç›®å½•ä¸‹ï¼ŒæŒ‰ç…§GNUmakefileã€makefileã€Makefileæ–‡ä»¶çš„é¡ºåºæŸ¥æ‰¾Makefileæ–‡ä»¶ï¼Œä¸€æ—¦æ‰¾åˆ°ï¼Œå°±å¼€å§‹è¯»å–è¿™ä¸ªæ–‡ä»¶å¹¶æ‰§è¡Œã€‚</p><p>å¤§å¤šæ•°çš„makeéƒ½æ”¯æŒâ€œmakefileâ€å’Œâ€œMakefileâ€è¿™ä¸¤ç§æ–‡ä»¶åï¼Œä½†<strong>æˆ‘å»ºè®®ä½¿ç”¨â€œMakefileâ€</strong>ã€‚å› ä¸ºè¿™ä¸ªæ–‡ä»¶åç¬¬ä¸€ä¸ªå­—ç¬¦å¤§å†™ï¼Œä¼šå¾ˆæ˜æ˜¾ï¼Œå®¹æ˜“è¾¨åˆ«ã€‚makeä¹Ÿæ”¯æŒ <code>-f</code> å’Œ <code>--file</code> å‚æ•°æ¥æŒ‡å®šå…¶ä»–æ–‡ä»¶åï¼Œæ¯”å¦‚ <code>make -f golang.mk</code> æˆ–è€… <code>make --file golang.mk</code> ã€‚</p><h2>Makefileè§„åˆ™ä»‹ç»</h2><p>å­¦ä¹ Makefileï¼Œæœ€æ ¸å¿ƒçš„å°±æ˜¯å­¦ä¹ Makefileçš„è§„åˆ™ã€‚è§„åˆ™æ˜¯Makefileä¸­çš„é‡è¦æ¦‚å¿µï¼Œå®ƒä¸€èˆ¬ç”±ç›®æ ‡ã€ä¾èµ–å’Œå‘½ä»¤ç»„æˆï¼Œç”¨æ¥æŒ‡å®šæºæ–‡ä»¶ç¼–è¯‘çš„å…ˆåé¡ºåºã€‚Makefileä¹‹æ‰€ä»¥å—æ¬¢è¿ï¼Œæ ¸å¿ƒåŸå› å°±æ˜¯Makefileè§„åˆ™ï¼Œå› ä¸ºMakefileè§„åˆ™å¯ä»¥è‡ªåŠ¨åˆ¤æ–­æ˜¯å¦éœ€è¦é‡æ–°ç¼–è¯‘æŸä¸ªç›®æ ‡ï¼Œä»è€Œç¡®ä¿ç›®æ ‡ä»…åœ¨éœ€è¦æ—¶ç¼–è¯‘ã€‚</p><p>è¿™ä¸€è®²æˆ‘ä»¬ä¸»è¦æ¥çœ‹Makefileè§„åˆ™é‡Œçš„è§„åˆ™è¯­æ³•ã€ä¼ªç›®æ ‡å’Œorder-onlyä¾èµ–ã€‚</p><h3>è§„åˆ™è¯­æ³•</h3><p>Makefileçš„è§„åˆ™è¯­æ³•ï¼Œä¸»è¦åŒ…æ‹¬targetã€prerequisiteså’Œcommandï¼Œç¤ºä¾‹å¦‚ä¸‹ï¼š</p><pre><code>target ...: prerequisites ...
    command
	  ...
	  ...
</code></pre><p><strong>targetï¼Œ</strong>å¯ä»¥æ˜¯ä¸€ä¸ªobject fileï¼ˆç›®æ ‡æ–‡ä»¶ï¼‰ï¼Œä¹Ÿå¯ä»¥æ˜¯ä¸€ä¸ªæ‰§è¡Œæ–‡ä»¶ï¼Œè¿˜å¯ä»¥æ˜¯ä¸€ä¸ªæ ‡ç­¾ï¼ˆlabelï¼‰ã€‚targetå¯ä½¿ç”¨é€šé…ç¬¦ï¼Œå½“æœ‰å¤šä¸ªç›®æ ‡æ—¶ï¼Œç›®æ ‡ä¹‹é—´ç”¨ç©ºæ ¼åˆ†éš”ã€‚</p><p><strong>prerequisitesï¼Œ</strong>ä»£è¡¨ç”Ÿæˆè¯¥targetæ‰€éœ€è¦çš„ä¾èµ–é¡¹ã€‚å½“æœ‰å¤šä¸ªä¾èµ–é¡¹æ—¶ï¼Œä¾èµ–é¡¹ä¹‹é—´ç”¨ç©ºæ ¼åˆ†éš”ã€‚</p><p><strong>command</strong>ï¼Œä»£è¡¨è¯¥targetè¦æ‰§è¡Œçš„å‘½ä»¤ï¼ˆå¯ä»¥æ˜¯ä»»æ„çš„shellå‘½ä»¤ï¼‰ã€‚</p><ul>
<li>åœ¨æ‰§è¡Œcommandä¹‹å‰ï¼Œé»˜è®¤ä¼šå…ˆæ‰“å°å‡ºè¯¥å‘½ä»¤ï¼Œç„¶åå†è¾“å‡ºå‘½ä»¤çš„ç»“æœï¼›å¦‚æœä¸æƒ³æ‰“å°å‡ºå‘½ä»¤ï¼Œå¯åœ¨å„ä¸ªcommandå‰åŠ ä¸Š<code>@</code>ã€‚</li>
<li>commandå¯ä»¥ä¸ºå¤šæ¡ï¼Œä¹Ÿå¯ä»¥åˆ†è¡Œå†™ï¼Œä½†æ¯è¡Œéƒ½è¦ä»¥tabé”®å¼€å§‹ã€‚å¦å¤–ï¼Œå¦‚æœåä¸€æ¡å‘½ä»¤ä¾èµ–å‰ä¸€æ¡å‘½ä»¤ï¼Œåˆ™è¿™ä¸¤æ¡å‘½ä»¤éœ€è¦å†™åœ¨åŒä¸€è¡Œï¼Œå¹¶ç”¨åˆ†å·è¿›è¡Œåˆ†éš”ã€‚</li>
<li>å¦‚æœè¦å¿½ç•¥å‘½ä»¤çš„å‡ºé”™ï¼Œéœ€è¦åœ¨å„ä¸ªcommandä¹‹å‰åŠ ä¸Šå‡å·<code>-</code>ã€‚</li>
</ul><p><strong>åªè¦targetsä¸å­˜åœ¨ï¼Œæˆ–prerequisitesä¸­æœ‰ä¸€ä¸ªä»¥ä¸Šçš„æ–‡ä»¶æ¯”targetsæ–‡ä»¶æ–°ï¼Œé‚£ä¹ˆcommandæ‰€å®šä¹‰çš„å‘½ä»¤å°±ä¼šè¢«æ‰§è¡Œï¼Œä»è€Œäº§ç”Ÿæˆ‘ä»¬éœ€è¦çš„æ–‡ä»¶ï¼Œæˆ–æ‰§è¡Œæˆ‘ä»¬æœŸæœ›çš„æ“ä½œã€‚</strong></p><p>æˆ‘ä»¬ç›´æ¥é€šè¿‡ä¸€ä¸ªä¾‹å­æ¥ç†è§£ä¸‹Makefileçš„è§„åˆ™å§ã€‚</p><p>ç¬¬ä¸€æ­¥ï¼Œå…ˆç¼–å†™ä¸€ä¸ªhello.cæ–‡ä»¶ã€‚</p><pre><code>#include &lt;stdio.h&gt;
int main()
{
  printf(&quot;Hello World!\n&quot;);
  return 0;
}
</code></pre><p>ç¬¬äºŒæ­¥ï¼Œåœ¨å½“å‰ç›®å½•ä¸‹ï¼Œç¼–å†™Makefileæ–‡ä»¶ã€‚</p><pre><code>hello: hello.o
	gcc -o hello hello.o

hello.o: hello.c
	gcc -c hello.c

clean:
	rm hello.o
</code></pre><p>ç¬¬ä¸‰æ­¥ï¼Œæ‰§è¡Œmakeï¼Œäº§ç”Ÿå¯æ‰§è¡Œæ–‡ä»¶ã€‚</p><pre><code>$ make
gcc -c hello.c
gcc -o hello hello.o
$ ls
hello  hello.c  hello.o  Makefile
</code></pre><p>ä¸Šé¢çš„ç¤ºä¾‹Makefileæ–‡ä»¶æœ‰ä¸¤ä¸ªtargetï¼Œåˆ†åˆ«æ˜¯helloå’Œhello.oï¼Œæ¯ä¸ªtargetéƒ½æŒ‡å®šäº†æ„å»ºcommandã€‚å½“æ‰§è¡Œmakeå‘½ä»¤æ—¶ï¼Œå‘ç°helloã€hello.oæ–‡ä»¶ä¸å­˜åœ¨ï¼Œå°±ä¼šæ‰§è¡Œcommandå‘½ä»¤ç”Ÿæˆtargetã€‚</p><p>ç¬¬å››æ­¥ï¼Œä¸æ›´æ–°ä»»ä½•æ–‡ä»¶ï¼Œå†æ¬¡æ‰§è¡Œmakeã€‚</p><pre><code>$ make
make: 'hello' is up to date.
</code></pre><p>å½“targetå­˜åœ¨ï¼Œå¹¶ä¸”prerequisiteséƒ½ä¸æ¯”targetæ–°æ—¶ï¼Œä¸ä¼šæ‰§è¡Œå¯¹åº”çš„commandã€‚</p><p>ç¬¬äº”æ­¥ï¼Œæ›´æ–°hello.cï¼Œå¹¶å†æ¬¡æ‰§è¡Œmakeã€‚</p><pre><code>$ touch hello.c
$ make
gcc -c hello.c
gcc -o hello hello.o
</code></pre><p>å½“targetå­˜åœ¨ï¼Œä½† prerequisites æ¯” target æ–°æ—¶ï¼Œä¼šé‡æ–°æ‰§è¡Œå¯¹åº”çš„commandã€‚</p><p>ç¬¬å…­æ­¥ï¼Œæ¸…ç†ç¼–è¯‘ä¸­é—´æ–‡ä»¶ã€‚</p><p>Makefileä¸€èˆ¬éƒ½ä¼šæœ‰ä¸€ä¸ªcleanä¼ªç›®æ ‡ï¼Œç”¨æ¥æ¸…ç†ç¼–è¯‘ä¸­é—´äº§ç‰©ï¼Œæˆ–è€…å¯¹æºç ç›®å½•åšä¸€äº›å®šåˆ¶åŒ–çš„æ¸…ç†ï¼š</p><pre><code>$ make clean
rm hello.o
</code></pre><p>æˆ‘ä»¬å¯ä»¥åœ¨è§„åˆ™ä¸­ä½¿ç”¨é€šé…ç¬¦ï¼Œmake æ”¯æŒä¸‰ä¸ªé€šé…ç¬¦ï¼š*ï¼Œ?å’Œ~ï¼Œä¾‹å¦‚ï¼š</p><pre><code>objects = *.o
print: *.c
    rm *.c
</code></pre><h3>ä¼ªç›®æ ‡</h3><p>æ¥ä¸‹æ¥æˆ‘ä»¬ä»‹ç»ä¸‹Makefileä¸­çš„ä¼ªç›®æ ‡ã€‚Makefileçš„ç®¡ç†èƒ½åŠ›åŸºæœ¬ä¸Šéƒ½æ˜¯é€šè¿‡ä¼ªç›®æ ‡æ¥å®ç°çš„ã€‚</p><p>åœ¨ä¸Šé¢çš„Makefileç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬å®šä¹‰äº†ä¸€ä¸ªcleanç›®æ ‡ï¼Œè¿™å…¶å®æ˜¯ä¸€ä¸ªä¼ªç›®æ ‡ï¼Œä¹Ÿå°±æ˜¯è¯´æˆ‘ä»¬ä¸ä¼šä¸ºè¯¥ç›®æ ‡ç”Ÿæˆä»»ä½•æ–‡ä»¶ã€‚å› ä¸ºä¼ªç›®æ ‡ä¸æ˜¯æ–‡ä»¶ï¼Œmake æ— æ³•ç”Ÿæˆå®ƒçš„ä¾èµ–å…³ç³»ï¼Œä¹Ÿæ— æ³•å†³å®šæ˜¯å¦è¦æ‰§è¡Œå®ƒã€‚</p><p>é€šå¸¸æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬éœ€è¦æ˜¾å¼åœ°æ ‡è¯†è¿™ä¸ªç›®æ ‡ä¸ºä¼ªç›®æ ‡ã€‚åœ¨Makefileä¸­å¯ä»¥ä½¿ç”¨<code>.PHONY</code>æ¥æ ‡è¯†ä¸€ä¸ªç›®æ ‡ä¸ºä¼ªç›®æ ‡ï¼š</p><pre><code>.PHONY: clean
clean:
    rm hello.o
</code></pre><p>ä¼ªç›®æ ‡å¯ä»¥æœ‰ä¾èµ–æ–‡ä»¶ï¼Œä¹Ÿå¯ä»¥ä½œä¸ºâ€œé»˜è®¤ç›®æ ‡â€ï¼Œä¾‹å¦‚ï¼š</p><pre><code>.PHONY: all
all: lint test build
</code></pre><p>å› ä¸ºä¼ªç›®æ ‡æ€»æ˜¯ä¼šè¢«æ‰§è¡Œï¼Œæ‰€ä»¥å…¶ä¾èµ–æ€»æ˜¯ä¼šè¢«å†³è®®ã€‚é€šè¿‡è¿™ç§æ–¹å¼ï¼Œå¯ä»¥è¾¾åˆ°<strong>åŒæ—¶æ‰§è¡Œæ‰€æœ‰ä¾èµ–é¡¹</strong>çš„ç›®çš„ã€‚</p><h3>order-onlyä¾èµ–</h3><p>åœ¨ä¸Šé¢ä»‹ç»çš„è§„åˆ™ä¸­ï¼Œåªè¦prerequisitesä¸­æœ‰ä»»ä½•æ–‡ä»¶å‘ç”Ÿæ”¹å˜ï¼Œå°±ä¼šé‡æ–°æ„é€ targetã€‚ä½†æ˜¯æœ‰æ—¶å€™ï¼Œæˆ‘ä»¬å¸Œæœ›<strong>åªæœ‰å½“prerequisitesä¸­çš„éƒ¨åˆ†æ–‡ä»¶æ”¹å˜æ—¶ï¼Œæ‰é‡æ–°æ„é€ targetã€‚</strong>è¿™æ—¶ï¼Œä½ å¯ä»¥é€šè¿‡order-only prerequisiteså®ç°ã€‚</p><p>order-only prerequisitesçš„å½¢å¼å¦‚ä¸‹ï¼š</p><pre><code>targets : normal-prerequisites | order-only-prerequisites
    command
    ...
    ...
</code></pre><p>åœ¨ä¸Šé¢çš„è§„åˆ™ä¸­ï¼Œåªæœ‰ç¬¬ä¸€æ¬¡æ„é€ targetsæ—¶ï¼Œæ‰ä¼šä½¿ç”¨order-only-prerequisitesã€‚åé¢å³ä½¿order-only-prerequisiteså‘ç”Ÿæ”¹å˜ï¼Œä¹Ÿä¸ä¼šé‡æ–°æ„é€ targetsã€‚</p><p>åªæœ‰normal-prerequisitesä¸­çš„æ–‡ä»¶å‘ç”Ÿæ”¹å˜æ—¶ï¼Œæ‰ä¼šé‡æ–°æ„é€ targetsã€‚è¿™é‡Œï¼Œç¬¦å·â€œ | â€åé¢çš„prerequisiteså°±æ˜¯order-only-prerequisitesã€‚</p><p>åˆ°è¿™é‡Œï¼Œæˆ‘ä»¬å°±ä»‹ç»äº†Makefileçš„è§„åˆ™ã€‚æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å†æ¥çœ‹ä¸‹Makefileä¸­çš„ä¸€äº›æ ¸å¿ƒè¯­æ³•çŸ¥è¯†ã€‚</p><h2>Makefileè¯­æ³•æ¦‚è§ˆ</h2><p>å› ä¸ºMakefileçš„è¯­æ³•æ¯”è¾ƒå¤šï¼Œè¿™ä¸€è®²åªä»‹ç»Makefileçš„æ ¸å¿ƒè¯­æ³•ï¼Œä»¥åŠ IAMé¡¹ç›®çš„Makefileç”¨åˆ°çš„è¯­æ³•ï¼ŒåŒ…æ‹¬å‘½ä»¤ã€å˜é‡ã€æ¡ä»¶è¯­å¥å’Œå‡½æ•°ã€‚å› ä¸ºMakefileæ²¡æœ‰å¤ªå¤šå¤æ‚çš„è¯­æ³•ï¼Œä½ æŒæ¡äº†è¿™äº›çŸ¥è¯†ç‚¹ä¹‹åï¼Œå†åœ¨å®è·µä¸­å¤šåŠ è¿ç”¨ï¼Œèä¼šè´¯é€šï¼Œå°±å¯ä»¥å†™å‡ºéå¸¸å¤æ‚ã€åŠŸèƒ½å¼ºå¤§çš„Makefileæ–‡ä»¶äº†ã€‚</p><h3>å‘½ä»¤</h3><p>Makefileæ”¯æŒLinuxå‘½ä»¤ï¼Œè°ƒç”¨æ–¹å¼è·Ÿåœ¨Linuxç³»ç»Ÿä¸‹è°ƒç”¨å‘½ä»¤çš„æ–¹å¼åŸºæœ¬ä¸€è‡´ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œmakeä¼šæŠŠæ­£åœ¨æ‰§è¡Œçš„å‘½ä»¤è¾“å‡ºåˆ°å½“å‰å±å¹•ä¸Šã€‚ä½†æˆ‘ä»¬å¯ä»¥é€šè¿‡åœ¨å‘½ä»¤å‰åŠ <code>@</code>ç¬¦å·çš„æ–¹å¼ï¼Œç¦æ­¢makeè¾“å‡ºå½“å‰æ­£åœ¨æ‰§è¡Œçš„å‘½ä»¤ã€‚</p><p>æˆ‘ä»¬çœ‹ä¸€ä¸ªä¾‹å­ã€‚ç°åœ¨æœ‰è¿™ä¹ˆä¸€ä¸ªMakefileï¼š</p><pre><code>.PHONY: test
test:
    echo &quot;hello world&quot;
</code></pre><p>æ‰§è¡Œmakeå‘½ä»¤ï¼š</p><pre><code>$ make test
echo &quot;hello world&quot;
hello world
</code></pre><p>å¯ä»¥çœ‹åˆ°ï¼Œmakeè¾“å‡ºäº†æ‰§è¡Œçš„å‘½ä»¤ã€‚å¾ˆå¤šæ—¶å€™ï¼Œæˆ‘ä»¬ä¸éœ€è¦è¿™æ ·çš„æç¤ºï¼Œå› ä¸ºæˆ‘ä»¬æ›´æƒ³çœ‹çš„æ˜¯å‘½ä»¤äº§ç”Ÿçš„æ—¥å¿—ï¼Œè€Œä¸æ˜¯æ‰§è¡Œçš„å‘½ä»¤ã€‚è¿™æ—¶å°±å¯ä»¥åœ¨å‘½ä»¤è¡Œå‰åŠ <code>@</code>ï¼Œç¦æ­¢makeè¾“å‡ºæ‰€æ‰§è¡Œçš„å‘½ä»¤ï¼š</p><pre><code>.PHONY: test
test:
    @echo &quot;hello world&quot;
</code></pre><p>å†æ¬¡æ‰§è¡Œmakeå‘½ä»¤ï¼š</p><pre><code>$ make test
hello world
</code></pre><p>å¯ä»¥çœ‹åˆ°ï¼Œmakeåªæ˜¯æ‰§è¡Œäº†å‘½ä»¤ï¼Œè€Œæ²¡æœ‰æ‰“å°å‘½ä»¤æœ¬èº«ã€‚è¿™æ ·makeè¾“å‡ºå°±æ¸…æ™°äº†å¾ˆå¤šã€‚</p><p>è¿™é‡Œï¼Œ<strong>æˆ‘å»ºè®®åœ¨å‘½ä»¤å‰éƒ½åŠ </strong><code>@</code>ç¬¦å·ï¼Œç¦æ­¢æ‰“å°å‘½ä»¤æœ¬èº«ï¼Œä»¥ä¿è¯ä½ çš„Makefileè¾“å‡ºæ˜“äºé˜…è¯»çš„ã€æœ‰ç”¨çš„ä¿¡æ¯ã€‚</p><p>é»˜è®¤æƒ…å†µä¸‹ï¼Œæ¯æ¡å‘½ä»¤æ‰§è¡Œå®Œmakeå°±ä¼šæ£€æŸ¥å…¶è¿”å›ç ã€‚å¦‚æœè¿”å›æˆåŠŸï¼ˆè¿”å›ç ä¸º0ï¼‰ï¼Œmakeå°±æ‰§è¡Œä¸‹ä¸€æ¡æŒ‡ä»¤ï¼›å¦‚æœè¿”å›å¤±è´¥ï¼ˆè¿”å›ç é0ï¼‰ï¼Œmakeå°±ä¼šç»ˆæ­¢å½“å‰å‘½ä»¤ã€‚å¾ˆå¤šæ—¶å€™ï¼Œå‘½ä»¤å‡ºé”™ï¼ˆæ¯”å¦‚åˆ é™¤äº†ä¸€ä¸ªä¸å­˜åœ¨çš„æ–‡ä»¶ï¼‰æ—¶ï¼Œæˆ‘ä»¬å¹¶ä¸æƒ³ç»ˆæ­¢ï¼Œè¿™æ—¶å°±å¯ä»¥åœ¨å‘½ä»¤è¡Œå‰åŠ  <code>-</code> ç¬¦å·ï¼Œæ¥è®©makeå¿½ç•¥å‘½ä»¤çš„å‡ºé”™ï¼Œä»¥ç»§ç»­æ‰§è¡Œä¸‹ä¸€æ¡å‘½ä»¤ï¼Œæ¯”å¦‚ï¼š</p><pre><code>clean:
    -rm hello.o
</code></pre><h3>å˜é‡</h3><p>å˜é‡ï¼Œå¯èƒ½æ˜¯Makefileä¸­ä½¿ç”¨æœ€é¢‘ç¹çš„è¯­æ³•äº†ï¼ŒMakefileæ”¯æŒå˜é‡èµ‹å€¼ã€å¤šè¡Œå˜é‡å’Œç¯å¢ƒå˜é‡ã€‚å¦å¤–ï¼ŒMakefileè¿˜å†…ç½®äº†ä¸€äº›ç‰¹æ®Šå˜é‡å’Œè‡ªåŠ¨åŒ–å˜é‡ã€‚</p><p>æˆ‘ä»¬å…ˆæ¥çœ‹ä¸‹æœ€åŸºæœ¬çš„<strong>å˜é‡èµ‹å€¼</strong>åŠŸèƒ½ã€‚</p><p>Makefileä¹Ÿå¯ä»¥åƒå…¶ä»–è¯­è¨€ä¸€æ ·æ”¯æŒå˜é‡ã€‚åœ¨ä½¿ç”¨å˜é‡æ—¶ï¼Œä¼šåƒshellå˜é‡ä¸€æ ·åŸåœ°å±•å¼€ï¼Œç„¶åå†æ‰§è¡Œæ›¿æ¢åçš„å†…å®¹ã€‚</p><p>Makefileå¯ä»¥é€šè¿‡å˜é‡å£°æ˜æ¥å£°æ˜ä¸€ä¸ªå˜é‡ï¼Œå˜é‡åœ¨å£°æ˜æ—¶éœ€è¦èµ‹äºˆä¸€ä¸ªåˆå€¼ï¼Œæ¯”å¦‚<code>ROOT_PACKAGE=github.com/marmotedu/iam</code>ã€‚</p><p>å¼•ç”¨å˜é‡æ—¶å¯ä»¥é€šè¿‡<code>$()</code>æˆ–è€…<code>${}</code>æ–¹å¼å¼•ç”¨ã€‚æˆ‘çš„å»ºè®®æ˜¯ï¼Œç”¨<code>$()</code>æ–¹å¼å¼•ç”¨å˜é‡ï¼Œä¾‹å¦‚<code>$(ROOT_PACKAGE)</code>ï¼Œä¹Ÿå»ºè®®æ•´ä¸ªmakefileçš„å˜é‡å¼•ç”¨æ–¹å¼ä¿æŒä¸€è‡´ã€‚</p><p>å˜é‡ä¼šåƒbashå˜é‡ä¸€æ ·ï¼Œåœ¨ä½¿ç”¨å®ƒçš„åœ°æ–¹å±•å¼€ã€‚æ¯”å¦‚ï¼š</p><pre><code>GO=go
build:
    $(GO) build -v .
</code></pre><p>å±•å¼€åä¸ºï¼š</p><pre><code>GO=go
build:
    go build -v .
</code></pre><p>æ¥ä¸‹æ¥ï¼Œæˆ‘ç»™ä½ ä»‹ç»ä¸‹Makefileä¸­çš„4ç§å˜é‡èµ‹å€¼æ–¹æ³•ã€‚</p><ol>
<li><code>=</code> æœ€åŸºæœ¬çš„èµ‹å€¼æ–¹æ³•ã€‚</li>
</ol><p>ä¾‹å¦‚ï¼š</p><pre><code>BASE_IMAGE = alpine:3.10
</code></pre><p>ä½¿ç”¨ <code>=</code> è¿›è¡Œèµ‹å€¼æ—¶ï¼Œè¦æ³¨æ„ä¸‹é¢è¿™æ ·çš„æƒ…å†µï¼š</p><pre><code>A = a
B = $(A) b
A = c
</code></pre><p>Bæœ€åçš„å€¼ä¸º c bï¼Œè€Œä¸æ˜¯a bã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œåœ¨ç”¨å˜é‡ç»™å˜é‡èµ‹å€¼æ—¶ï¼Œå³è¾¹å˜é‡çš„å–å€¼ï¼Œå–çš„æ˜¯æœ€ç»ˆçš„å˜é‡å€¼ã€‚</p><ol start="2">
<li><code>:=</code>ç›´æ¥èµ‹å€¼ï¼Œèµ‹äºˆå½“å‰ä½ç½®çš„å€¼ã€‚</li>
</ol><p>ä¾‹å¦‚ï¼š</p><pre><code>A = a
B := $(A) b
A = c
</code></pre><p>Bæœ€åçš„å€¼ä¸º a bã€‚é€šè¿‡ <code>:=</code> çš„èµ‹å€¼æ–¹å¼ï¼Œå¯ä»¥é¿å… <code>=</code> èµ‹å€¼å¸¦æ¥çš„æ½œåœ¨çš„ä¸ä¸€è‡´ã€‚</p><ol start="3">
<li><code>?=</code> è¡¨ç¤ºå¦‚æœè¯¥å˜é‡æ²¡æœ‰è¢«èµ‹å€¼ï¼Œåˆ™èµ‹äºˆç­‰å·åçš„å€¼ã€‚</li>
</ol><p>ä¾‹å¦‚ï¼š</p><pre><code>PLATFORMS ?= linux_amd64 linux_arm64
</code></pre><ol start="4">
<li><code>+=</code>è¡¨ç¤ºå°†ç­‰å·åé¢çš„å€¼æ·»åŠ åˆ°å‰é¢çš„å˜é‡ä¸Šã€‚</li>
</ol><p>ä¾‹å¦‚ï¼š</p><pre><code>MAKEFLAGS += --no-print-directory
</code></pre><p>Makefileè¿˜æ”¯æŒ<strong>å¤šè¡Œå˜é‡</strong>ã€‚å¯ä»¥é€šè¿‡defineå…³é”®å­—è®¾ç½®å¤šè¡Œå˜é‡ï¼Œå˜é‡ä¸­å…è®¸æ¢è¡Œã€‚å®šä¹‰æ–¹å¼ä¸ºï¼š</p><pre><code>define å˜é‡å
å˜é‡å†…å®¹
...
endef
</code></pre><p>å˜é‡çš„å†…å®¹å¯ä»¥åŒ…å«å‡½æ•°ã€å‘½ä»¤ã€æ–‡å­—æˆ–æ˜¯å…¶ä»–å˜é‡ã€‚ä¾‹å¦‚ï¼Œæˆ‘ä»¬å¯ä»¥å®šä¹‰ä¸€ä¸ªUSAGE_OPTIONSå˜é‡ï¼š</p><pre><code>define USAGE_OPTIONS

Options:
  DEBUG        Whether to generate debug symbols. Default is 0.
  BINS         The binaries to build. Default is all of cmd.
  ...
  V            Set to 1 enable verbose build. Default is 0.
endef
</code></pre><p>Makefileè¿˜æ”¯æŒ<strong>ç¯å¢ƒå˜é‡</strong>ã€‚åœ¨Makefileä¸­ï¼Œæœ‰ä¸¤ç§ç¯å¢ƒå˜é‡ï¼Œåˆ†åˆ«æ˜¯Makefileé¢„å®šä¹‰çš„ç¯å¢ƒå˜é‡å’Œè‡ªå®šä¹‰çš„ç¯å¢ƒå˜é‡ã€‚</p><p>å…¶ä¸­ï¼Œè‡ªå®šä¹‰çš„ç¯å¢ƒå˜é‡å¯ä»¥è¦†ç›–Makefileé¢„å®šä¹‰çš„ç¯å¢ƒå˜é‡ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼ŒMakefileä¸­å®šä¹‰çš„ç¯å¢ƒå˜é‡åªåœ¨å½“å‰Makefileæœ‰æ•ˆï¼Œå¦‚æœæƒ³å‘ä¸‹å±‚ä¼ é€’ï¼ˆMakefileä¸­è°ƒç”¨å¦ä¸€ä¸ªMakefileï¼‰ï¼Œéœ€è¦ä½¿ç”¨exportå…³é”®å­—æ¥å£°æ˜ã€‚</p><p>ä¸‹é¢çš„ä¾‹å­å£°æ˜äº†ä¸€ä¸ªç¯å¢ƒå˜é‡ï¼Œå¹¶å¯ä»¥åœ¨ä¸‹å±‚Makefileä¸­ä½¿ç”¨ï¼š</p><pre><code>...
export USAGE_OPTIONS
...
</code></pre><p>æ­¤å¤–ï¼ŒMakefileè¿˜æ”¯æŒä¸¤ç§å†…ç½®çš„å˜é‡ï¼šç‰¹æ®Šå˜é‡å’Œè‡ªåŠ¨åŒ–å˜é‡ã€‚</p><p><strong>ç‰¹æ®Šå˜é‡</strong>æ˜¯makeæå‰å®šä¹‰å¥½çš„ï¼Œå¯ä»¥åœ¨makefileä¸­ç›´æ¥å¼•ç”¨ã€‚ç‰¹æ®Šå˜é‡åˆ—è¡¨å¦‚ä¸‹ï¼š</p><p><img src="https://static001.geekbang.org/resource/image/c1/1d/c1cba21aaed2eb0117yyb0470byy641d.png?wh=1052x978" alt=""></p><p>Makefileè¿˜æ”¯æŒ<strong>è‡ªåŠ¨åŒ–å˜é‡</strong>ã€‚è‡ªåŠ¨åŒ–å˜é‡å¯ä»¥æé«˜æˆ‘ä»¬ç¼–å†™Makefileçš„æ•ˆç‡å’Œè´¨é‡ã€‚</p><p>åœ¨Makefileçš„æ¨¡å¼è§„åˆ™ä¸­ï¼Œç›®æ ‡å’Œä¾èµ–æ–‡ä»¶éƒ½æ˜¯ä¸€ç³»åˆ—çš„æ–‡ä»¶ï¼Œé‚£ä¹ˆæˆ‘ä»¬å¦‚ä½•ä¹¦å†™ä¸€ä¸ªå‘½ä»¤ï¼Œæ¥å®Œæˆä»ä¸åŒçš„ä¾èµ–æ–‡ä»¶ç”Ÿæˆç›¸å¯¹åº”çš„ç›®æ ‡å‘¢ï¼Ÿ</p><p>è¿™æ—¶å°±å¯ä»¥ç”¨åˆ°è‡ªåŠ¨åŒ–å˜é‡ã€‚æ‰€è°“è‡ªåŠ¨åŒ–å˜é‡ï¼Œå°±æ˜¯è¿™ç§å˜é‡ä¼šæŠŠæ¨¡å¼ä¸­æ‰€å®šä¹‰çš„ä¸€ç³»åˆ—çš„æ–‡ä»¶è‡ªåŠ¨åœ°æŒ¨ä¸ªå–å‡ºï¼Œä¸€ç›´åˆ°æ‰€æœ‰ç¬¦åˆæ¨¡å¼çš„æ–‡ä»¶éƒ½å–å®Œä¸ºæ­¢ã€‚è¿™ç§è‡ªåŠ¨åŒ–å˜é‡åªåº”å‡ºç°åœ¨è§„åˆ™çš„å‘½ä»¤ä¸­ã€‚Makefileä¸­æ”¯æŒçš„è‡ªåŠ¨åŒ–å˜é‡è§ä¸‹è¡¨ã€‚</p><p><img src="https://static001.geekbang.org/resource/image/13/12/13ec33008eaff973c0dd854a795ff712.png?wh=1263x1303" alt=""></p><p>ä¸Šé¢è¿™äº›è‡ªåŠ¨åŒ–å˜é‡ä¸­ï¼Œ<code>$*</code>æ˜¯ç”¨å¾—æœ€å¤šçš„ã€‚<code>$*</code> å¯¹äºæ„é€ æœ‰å…³è”çš„æ–‡ä»¶åæ˜¯æ¯”è¾ƒæœ‰æ•ˆçš„ã€‚å¦‚æœç›®æ ‡ä¸­æ²¡æœ‰æ¨¡å¼çš„å®šä¹‰ï¼Œé‚£ä¹ˆ <code>$*</code> ä¹Ÿå°±ä¸èƒ½è¢«æ¨å¯¼å‡ºã€‚ä½†æ˜¯ï¼Œå¦‚æœç›®æ ‡æ–‡ä»¶çš„åç¼€æ˜¯makeæ‰€è¯†åˆ«çš„ï¼Œé‚£ä¹ˆ <code>$*</code> å°±æ˜¯é™¤äº†åç¼€çš„é‚£ä¸€éƒ¨åˆ†ã€‚ä¾‹å¦‚ï¼šå¦‚æœç›®æ ‡æ˜¯foo.c ï¼Œå› ä¸º.cæ˜¯makeæ‰€èƒ½è¯†åˆ«çš„åç¼€åï¼Œæ‰€ä»¥ <code>$*</code> çš„å€¼å°±æ˜¯fooã€‚</p><h3>æ¡ä»¶è¯­å¥</h3><p>Makefileä¹Ÿæ”¯æŒæ¡ä»¶è¯­å¥ã€‚è¿™é‡Œå…ˆçœ‹ä¸€ä¸ªç¤ºä¾‹ã€‚</p><p>ä¸‹é¢çš„ä¾‹å­åˆ¤æ–­å˜é‡<code>ROOT_PACKAGE</code>æ˜¯å¦ä¸ºç©ºï¼Œå¦‚æœä¸ºç©ºï¼Œåˆ™è¾“å‡ºé”™è¯¯ä¿¡æ¯ï¼Œä¸ä¸ºç©ºåˆ™æ‰“å°å˜é‡å€¼ï¼š</p><pre><code>ifeq ($(ROOT_PACKAGE),)
$(error the variable ROOT_PACKAGE must be set prior to including golang.mk)
else
$(info the value of ROOT_PACKAGE is $(ROOT_PACKAGE))
endif
</code></pre><p>æ¡ä»¶è¯­å¥çš„è¯­æ³•ä¸ºï¼š</p><pre><code># if ...
&lt;conditional-directive&gt;
&lt;text-if-true&gt;
endif
# if ... else ...
&lt;conditional-directive&gt;
&lt;text-if-true&gt;
else
&lt;text-if-false&gt;
endif
</code></pre><p>ä¾‹å¦‚ï¼Œåˆ¤æ–­ä¸¤ä¸ªå€¼æ˜¯å¦ç›¸ç­‰ï¼š</p><pre><code>ifeq æ¡ä»¶è¡¨è¾¾å¼
...
else
...
endif
</code></pre><ul>
<li>ifeqè¡¨ç¤ºæ¡ä»¶è¯­å¥çš„å¼€å§‹ï¼Œå¹¶æŒ‡å®šä¸€ä¸ªæ¡ä»¶è¡¨è¾¾å¼ã€‚è¡¨è¾¾å¼åŒ…å«ä¸¤ä¸ªå‚æ•°ï¼Œå‚æ•°ä¹‹é—´ç”¨é€—å·åˆ†éš”ï¼Œå¹¶ä¸”è¡¨è¾¾å¼ç”¨åœ†æ‹¬å·æ‹¬èµ·æ¥ã€‚</li>
<li>elseè¡¨ç¤ºæ¡ä»¶è¡¨è¾¾å¼ä¸ºå‡çš„æƒ…å†µã€‚</li>
<li>endifè¡¨ç¤ºä¸€ä¸ªæ¡ä»¶è¯­å¥çš„ç»“æŸï¼Œä»»ä½•ä¸€ä¸ªæ¡ä»¶è¡¨è¾¾å¼éƒ½åº”è¯¥ä»¥endifç»“æŸã€‚</li>
<li><conditional-directive>è¡¨ç¤ºæ¡ä»¶å…³é”®å­—ï¼Œæœ‰4ä¸ªå…³é”®å­—ï¼šifeqã€ifneqã€ifdefã€ifndefã€‚</conditional-directive></li>
</ul><p>ä¸ºäº†åŠ æ·±ä½ çš„ç†è§£ï¼Œæˆ‘ä»¬åˆ†åˆ«æ¥çœ‹ä¸‹è¿™4ä¸ªå…³é”®å­—çš„ä¾‹å­ã€‚</p><ol>
<li>ifeqï¼šæ¡ä»¶åˆ¤æ–­ï¼Œåˆ¤æ–­æ˜¯å¦ç›¸ç­‰ã€‚</li>
</ol><p>ä¾‹å¦‚ï¼š</p><pre><code>ifeq (&lt;arg1&gt;, &lt;arg2&gt;)
ifeq '&lt;arg1&gt;' '&lt;arg2&gt;'
ifeq &quot;&lt;arg1&gt;&quot; &quot;&lt;arg2&gt;&quot;
ifeq &quot;&lt;arg1&gt;&quot; '&lt;arg2&gt;'
ifeq '&lt;arg1&gt;' &quot;&lt;arg2&gt;&quot;
</code></pre><p>æ¯”è¾ƒarg1å’Œarg2çš„å€¼æ˜¯å¦ç›¸åŒï¼Œå¦‚æœç›¸åŒåˆ™ä¸ºçœŸã€‚ä¹Ÿå¯ä»¥ç”¨makeå‡½æ•°/å˜é‡æ›¿ä»£arg1æˆ–arg2ï¼Œä¾‹å¦‚ <code>ifeq ($(origin ROOT_DIR),undefined)</code> æˆ– <code>ifeq ($(ROOT_PACKAGE),)</code> ã€‚originå‡½æ•°ä¼šåœ¨ä¹‹åä¸“é—¨è®²å‡½æ•°çš„ä¸€è®²ä¸­ä»‹ç»åˆ°ã€‚</p><ol start="2">
<li>ifneqï¼šæ¡ä»¶åˆ¤æ–­ï¼Œåˆ¤æ–­æ˜¯å¦ä¸ç›¸ç­‰ã€‚</li>
</ol><pre><code>ifneq (&lt;arg1&gt;, &lt;arg2&gt;)
ifneq '&lt;arg1&gt;' '&lt;arg2&gt;'
ifneq &quot;&lt;arg1&gt;&quot; &quot;&lt;arg2&gt;&quot;
ifneq &quot;&lt;arg1&gt;&quot; '&lt;arg2&gt;'
ifneq '&lt;arg1&gt;' &quot;&lt;arg2&gt;&quot;
</code></pre><p>æ¯”è¾ƒarg1å’Œarg2çš„å€¼æ˜¯å¦ä¸åŒï¼Œå¦‚æœä¸åŒåˆ™ä¸ºçœŸã€‚</p><ol start="3">
<li>ifdefï¼šæ¡ä»¶åˆ¤æ–­ï¼Œåˆ¤æ–­å˜é‡æ˜¯å¦å·²å®šä¹‰ã€‚</li>
</ol><pre><code>ifdef &lt;variable-name&gt;
</code></pre><p>å¦‚æœ<variable-name>å€¼éç©ºï¼Œåˆ™è¡¨è¾¾å¼ä¸ºçœŸï¼Œå¦åˆ™ä¸ºå‡ã€‚<variable-name>ä¹Ÿå¯ä»¥æ˜¯å‡½æ•°çš„è¿”å›å€¼ã€‚</variable-name></variable-name></p><ol start="4">
<li>ifndefï¼šæ¡ä»¶åˆ¤æ–­ï¼Œåˆ¤æ–­å˜é‡æ˜¯å¦æœªå®šä¹‰ã€‚</li>
</ol><pre><code>ifndef &lt;variable-name&gt;
</code></pre><p>å¦‚æœ<variable-name>å€¼ä¸ºç©ºï¼Œåˆ™è¡¨è¾¾å¼ä¸ºçœŸï¼Œå¦åˆ™ä¸ºå‡ã€‚<variable-name>ä¹Ÿå¯ä»¥æ˜¯å‡½æ•°çš„è¿”å›å€¼ã€‚</variable-name></variable-name></p><h3>å‡½æ•°</h3><p>MakefileåŒæ ·ä¹Ÿæ”¯æŒå‡½æ•°ï¼Œå‡½æ•°è¯­æ³•åŒ…æ‹¬å®šä¹‰è¯­æ³•å’Œè°ƒç”¨è¯­æ³•ã€‚</p><p><strong>æˆ‘ä»¬å…ˆæ¥çœ‹ä¸‹è‡ªå®šä¹‰å‡½æ•°ã€‚</strong> makeè§£é‡Šå™¨æä¾›äº†ä¸€ç³»åˆ—çš„å‡½æ•°ä¾›Makefileè°ƒç”¨ï¼Œè¿™äº›å‡½æ•°æ˜¯Makefileçš„é¢„å®šä¹‰å‡½æ•°ã€‚æˆ‘ä»¬å¯ä»¥é€šè¿‡defineå…³é”®å­—æ¥è‡ªå®šä¹‰ä¸€ä¸ªå‡½æ•°ã€‚è‡ªå®šä¹‰å‡½æ•°çš„è¯­æ³•ä¸ºï¼š</p><pre><code>define å‡½æ•°å
å‡½æ•°ä½“
endef
</code></pre><p>ä¾‹å¦‚ï¼Œä¸‹é¢è¿™ä¸ªè‡ªå®šä¹‰å‡½æ•°ï¼š</p><pre><code>define Foo
    @echo &quot;my name is $(0)&quot;
    @echo &quot;param is $(1)&quot;
endef
</code></pre><p>defineæœ¬è´¨ä¸Šæ˜¯å®šä¹‰ä¸€ä¸ªå¤šè¡Œå˜é‡ï¼Œå¯ä»¥åœ¨callçš„ä½œç”¨ä¸‹å½“ä½œå‡½æ•°æ¥ä½¿ç”¨ï¼Œåœ¨å…¶ä»–ä½ç½®ä½¿ç”¨åªèƒ½ä½œä¸ºå¤šè¡Œå˜é‡æ¥ä½¿ç”¨ï¼Œä¾‹å¦‚ï¼š</p><pre><code>var := $(call Foo)
new := $(Foo)
</code></pre><p>è‡ªå®šä¹‰å‡½æ•°æ˜¯ä¸€ç§è¿‡ç¨‹è°ƒç”¨ï¼Œæ²¡æœ‰ä»»ä½•çš„è¿”å›å€¼ã€‚å¯ä»¥ä½¿ç”¨è‡ªå®šä¹‰å‡½æ•°æ¥å®šä¹‰å‘½ä»¤çš„é›†åˆï¼Œå¹¶åº”ç”¨åœ¨è§„åˆ™ä¸­ã€‚</p><p><strong>å†æ¥çœ‹ä¸‹é¢„å®šä¹‰å‡½æ•°ã€‚</strong> åˆšæ‰æåˆ°ï¼Œmakeç¼–è¯‘å™¨ä¹Ÿå®šä¹‰äº†å¾ˆå¤šå‡½æ•°ï¼Œè¿™äº›å‡½æ•°å«ä½œé¢„å®šä¹‰å‡½æ•°ï¼Œè°ƒç”¨è¯­æ³•å’Œå˜é‡ç±»ä¼¼ï¼Œè¯­æ³•ä¸ºï¼š</p><pre><code>$(&lt;function&gt; &lt;arguments&gt;)
</code></pre><p>æˆ–è€…</p><pre><code>${&lt;function&gt; &lt;arguments&gt;}
</code></pre><p><code>&lt;function&gt;</code>æ˜¯å‡½æ•°åï¼Œ<code>&lt;arguments&gt;</code>æ˜¯å‡½æ•°å‚æ•°ï¼Œå‚æ•°é—´ç”¨é€—å·åˆ†å‰²ã€‚å‡½æ•°çš„å‚æ•°ä¹Ÿå¯ä»¥æ˜¯å˜é‡ã€‚</p><p>æˆ‘ä»¬æ¥çœ‹ä¸€ä¸ªä¾‹å­ï¼š</p><pre><code>PLATFORM = linux_amd64
GOOS := $(word 1, $(subst _, ,$(PLATFORM)))
</code></pre><p>ä¸Šé¢çš„ä¾‹å­ç”¨åˆ°äº†ä¸¤ä¸ªå‡½æ•°ï¼šwordå’Œsubstã€‚wordå‡½æ•°æœ‰ä¸¤ä¸ªå‚æ•°ï¼Œ1å’Œsubstå‡½æ•°çš„è¾“å‡ºã€‚substå‡½æ•°å°†PLATFORMå˜é‡å€¼ä¸­çš„_æ›¿æ¢æˆç©ºæ ¼ï¼ˆæ›¿æ¢åçš„PLATFORMå€¼ä¸ºlinux amd64ï¼‰ã€‚wordå‡½æ•°å–linux amd64å­—ç¬¦ä¸²ä¸­çš„ç¬¬ä¸€ä¸ªå•è¯ã€‚æ‰€ä»¥æœ€åGOOSçš„å€¼ä¸ºlinuxã€‚</p><p>Makefileé¢„å®šä¹‰å‡½æ•°èƒ½å¤Ÿå¸®åŠ©æˆ‘ä»¬å®ç°å¾ˆå¤šå¼ºå¤§çš„åŠŸèƒ½ï¼Œåœ¨ç¼–å†™Makefileçš„è¿‡ç¨‹ä¸­ï¼Œå¦‚æœæœ‰åŠŸèƒ½éœ€æ±‚ï¼Œå¯ä»¥ä¼˜å…ˆä½¿ç”¨è¿™äº›å‡½æ•°ã€‚å¦‚æœä½ æƒ³ä½¿ç”¨è¿™äº›å‡½æ•°ï¼Œé‚£å°±éœ€è¦çŸ¥é“æœ‰å“ªäº›å‡½æ•°ï¼Œä»¥åŠå®ƒä»¬å®ç°çš„åŠŸèƒ½ã€‚</p><p>å¸¸ç”¨çš„å‡½æ•°åŒ…æ‹¬ä¸‹é¢è¿™äº›ï¼Œä½ éœ€è¦å…ˆæœ‰ä¸ªå°è±¡ï¼Œä»¥åç”¨åˆ°æ—¶å†æ¥æŸ¥çœ‹ã€‚</p><p><img src="https://static001.geekbang.org/resource/image/29/8e/29956e1cfb4dea1b0yy25af561d4168e.jpg?wh=1755x3719" alt=""></p><h2>å¼•å…¥å…¶ä»–Makefile</h2><p>é™¤äº†Makefileè§„åˆ™ã€Makefileè¯­æ³•ä¹‹å¤–ï¼ŒMakefileè¿˜æœ‰å¾ˆå¤šç‰¹æ€§ï¼Œæ¯”å¦‚å¯ä»¥å¼•å…¥å…¶ä»–Makefileã€è‡ªåŠ¨ç”Ÿæˆä¾èµ–å…³ç³»ã€æ–‡ä»¶æœç´¢ç­‰ç­‰ã€‚è¿™é‡Œæˆ‘å†ä»‹ç»ä¸€ä¸ªIAMé¡¹ç›®çš„Makefileç”¨åˆ°çš„é‡ç‚¹ç‰¹æ€§ï¼šå¼•å…¥å…¶ä»–Makefileã€‚</p><p>åœ¨ <a href="https://time.geekbang.org/column/article/388920"><strong>14è®²</strong></a> ä¸­ï¼Œæˆ‘ä»¬ä»‹ç»è¿‡Makefileè¦ç»“æ„åŒ–ã€å±‚æ¬¡åŒ–ï¼Œè¿™ä¸€ç‚¹å¯ä»¥é€šè¿‡<strong>åœ¨é¡¹ç›®æ ¹ç›®å½•ä¸‹çš„Makefileä¸­å¼•å…¥å…¶ä»–Makefile</strong>æ¥å®ç°ã€‚</p><p>åœ¨Makefileä¸­ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡å…³é”®å­—includeï¼ŒæŠŠåˆ«çš„makefileåŒ…å«è¿›æ¥ï¼Œç±»ä¼¼äºCè¯­è¨€çš„<code>#include</code>ï¼Œè¢«åŒ…å«çš„æ–‡ä»¶ä¼šæ’å…¥åœ¨å½“å‰çš„ä½ç½®ã€‚includeç”¨æ³•ä¸º<code>include &lt;filename&gt;</code>ï¼Œç¤ºä¾‹å¦‚ä¸‹ï¼š</p><pre><code>include scripts/make-rules/common.mk
include scripts/make-rules/golang.mk
</code></pre><p>includeä¹Ÿå¯ä»¥åŒ…å«é€šé…ç¬¦<code>include scripts/make-rules/*</code>ã€‚makeå‘½ä»¤ä¼šæŒ‰ä¸‹é¢çš„é¡ºåºæŸ¥æ‰¾makefileæ–‡ä»¶ï¼š</p><ol>
<li>å¦‚æœæ˜¯ç»å¯¹æˆ–ç›¸å¯¹è·¯å¾„ï¼Œå°±ç›´æ¥æ ¹æ®è·¯å¾„includeè¿›æ¥ã€‚</li>
<li>å¦‚æœmakeæ‰§è¡Œæ—¶ï¼Œæœ‰<code>-I</code>æˆ–<code>--include-dir</code>å‚æ•°ï¼Œé‚£ä¹ˆmakeå°±ä¼šåœ¨è¿™ä¸ªå‚æ•°æ‰€æŒ‡å®šçš„ç›®å½•ä¸‹å»æ‰¾ã€‚</li>
<li>å¦‚æœç›®å½•<code>&lt;prefix&gt;/include</code>ï¼ˆä¸€èˆ¬æ˜¯<code>/usr/local/bin</code>æˆ–<code>/usr/include</code>ï¼‰å­˜åœ¨çš„è¯ï¼Œmakeä¹Ÿä¼šå»æ‰¾ã€‚</li>
</ol><p>å¦‚æœæœ‰æ–‡ä»¶æ²¡æœ‰æ‰¾åˆ°ï¼Œmakeä¼šç”Ÿæˆä¸€æ¡è­¦å‘Šä¿¡æ¯ï¼Œä½†ä¸ä¼šé©¬ä¸Šå‡ºç°è‡´å‘½é”™è¯¯ï¼Œè€Œæ˜¯ç»§ç»­è½½å…¥å…¶ä»–çš„æ–‡ä»¶ã€‚ä¸€æ—¦å®Œæˆmakefileçš„è¯»å–ï¼Œmakeä¼šå†é‡è¯•è¿™äº›æ²¡æœ‰æ‰¾åˆ°æˆ–æ˜¯ä¸èƒ½è¯»å–çš„æ–‡ä»¶ã€‚å¦‚æœè¿˜æ˜¯ä¸è¡Œï¼Œmakeæ‰ä¼šå‡ºç°ä¸€æ¡è‡´å‘½é”™è¯¯ä¿¡æ¯ã€‚å¦‚æœä½ æƒ³è®©makeå¿½ç•¥é‚£äº›æ— æ³•è¯»å–çš„æ–‡ä»¶ç»§ç»­æ‰§è¡Œï¼Œå¯ä»¥åœ¨includeå‰åŠ ä¸€ä¸ªå‡å·<code>-</code>ï¼Œå¦‚<code>-include &lt;filename&gt;</code>ã€‚</p><h2>æ€»ç»“</h2><p>åœ¨è¿™ä¸€è®²é‡Œï¼Œä¸ºäº†å¸®åŠ©ä½ ç¼–å†™ä¸€ä¸ªé«˜è´¨é‡çš„Makefileï¼Œæˆ‘é‡ç‚¹ä»‹ç»äº†Makefileè§„åˆ™å’ŒMakefileè¯­æ³•é‡Œçš„ä¸€äº›æ ¸å¿ƒè¯­æ³•çŸ¥è¯†ã€‚</p><p>åœ¨è®²Makefileè§„åˆ™æ—¶ï¼Œæˆ‘ä»¬ä¸»è¦å­¦ä¹ äº†è§„åˆ™è¯­æ³•ã€ä¼ªç›®æ ‡å’Œorder-onlyä¾èµ–ã€‚æŒæ¡äº†è¿™äº›Makefileè§„åˆ™ï¼Œä½ å°±æŒæ¡äº†Makefileä¸­æœ€æ ¸å¿ƒçš„å†…å®¹ã€‚</p><p>åœ¨ä»‹ç»Makefileçš„è¯­æ³•æ—¶ï¼Œæˆ‘åªä»‹ç»äº†Makefileçš„æ ¸å¿ƒè¯­æ³•ï¼Œä»¥åŠ IAMé¡¹ç›®çš„Makefileç”¨åˆ°çš„è¯­æ³•ï¼ŒåŒ…æ‹¬å‘½ä»¤ã€å˜é‡ã€æ¡ä»¶è¯­å¥å’Œå‡½æ•°ã€‚ä½ å¯èƒ½ä¼šè§‰å¾—è¿™äº›è¯­æ³•å­¦ä¹ èµ·æ¥æ¯”è¾ƒæ¯ç‡¥ï¼Œä½†è¿˜æ˜¯é‚£å¥è¯ï¼Œå·¥æ¬²å–„å…¶äº‹ï¼Œå¿…å…ˆåˆ©å…¶å™¨ã€‚å¸Œæœ›ä½ èƒ½ç†Ÿç»ƒæŒæ¡Makefileçš„æ ¸å¿ƒè¯­æ³•ï¼Œä¸ºç¼–å†™é«˜è´¨é‡çš„Makefileæ‰“å¥½åŸºç¡€ã€‚</p><p>ä»Šå¤©çš„å†…å®¹å°±åˆ°è¿™é‡Œå•¦ï¼Œæ¬¢è¿ä½ åœ¨ä¸‹é¢çš„ç•™è¨€åŒºè°ˆè°ˆè‡ªå·±çš„çœ‹æ³•ï¼Œæˆ‘ä»¬ä¸‹ä¸€è®²è§ã€‚</p><h2>ç²¾é€‰ç•™è¨€ï¼š</h2>
        <ul>
        
<li>
    <div>
        <div style="color: #888;font-size:15.25px;font-weight:400;            line-height:1.2">
            Tiandh  2021-06-28 09:30:58
        </div>
        <div style="color:#353535;font-weight:400;white-space:normal;            word-break:break-all;line-height:1.6">
            è€å¸ˆï¼Œè¿™ä¸¤å¥è¯ä¸ç†è§£<br>å› ä¸ºä¼ªç›®æ ‡ä¸æ˜¯æ–‡ä»¶ï¼Œmake æ— æ³•ç”Ÿæˆå®ƒçš„ä¾èµ–å…³ç³»ï¼Œä¹Ÿæ— æ³•å†³å®šæ˜¯å¦è¦æ‰§è¡Œå®ƒã€‚<br>å› ä¸ºä¼ªç›®æ ‡æ€»æ˜¯ä¼šè¢«æ‰§è¡Œï¼Œæ‰€ä»¥å…¶ä¾èµ–æ€»æ˜¯ä¼šè¢«å†³è®®ã€‚ 
        </div>
        <br/>
<div>
    <div style="color:#888;font-size:15.25px;font-weight:400;        line-height:1.2">ä½œè€…å›å¤2021-06-28 10:27:40</div>
    <div style="color:#353535;font-weight:400;white-space:normal;        word-break:break-all;line-height:1.6">å°±æ˜¯ä¼ªç›®æ ‡æ€»æ˜¯ä¼šè¢«æ‰§è¡Œ</div>
</div>
            
    </div>
</li>
            
<br/>

<li>
    <div>
        <div style="color: #888;font-size:15.25px;font-weight:400;            line-height:1.2">
            pedro  2021-06-28 08:08:25
        </div>
        <div style="color:#353535;font-weight:400;white-space:normal;            word-break:break-all;line-height:1.6">
            å‘¨ä¸€å°±æ›´æ–°ï¼Œå€¼ğŸ˜‚ [1èµ]
        </div>
        <br/>
<div>
    <div style="color:#888;font-size:15.25px;font-weight:400;        line-height:1.2">ç¼–è¾‘å›å¤2021-06-28 08:17:28</div>
    <div style="color:#353535;font-weight:400;white-space:normal;        word-break:break-all;line-height:1.6">è¿™ç¯‡æ˜¯é¢å¤–çš„åŠ é¤ï¼Œä¸å æ’æœŸå“¦</div>
</div>
            
    </div>
</li>
            
<br/>

<li>
    <div>
        <div style="color: #888;font-size:15.25px;font-weight:400;            line-height:1.2">
            helloworld  2021-06-28 00:45:02
        </div>
        <div style="color:#353535;font-weight:400;white-space:normal;            word-break:break-all;line-height:1.6">
            æˆ‘è§‰å¾—å˜é‡ç”¨${}, å‡½æ•°ç”¨$(),è¿™æ ·èƒ½å¾ˆå¥½åŒºåˆ†ï¼Œå¯¹ç†Ÿæ‚‰shellçš„äººä¹Ÿæ›´å‹å¥½ [1èµ]
        </div>
        <br/>
<div>
    <div style="color:#888;font-size:15.25px;font-weight:400;        line-height:1.2">ä½œè€…å›å¤2021-06-28 10:26:50</div>
    <div style="color:#353535;font-weight:400;white-space:normal;        word-break:break-all;line-height:1.6">å¬èµ·æ¥æ²¡æ¯›ç—…ï¼Œä¿æŒä¸€è‡´å³å¯</div>
</div>
            
    </div>
</li>
            </ul>
</div>
</body>
</html>